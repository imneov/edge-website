# 四、关键架构模式总结

通过源码分析，总结出平台的 **8 个核心架构模式**，建议在白皮书中作为"技术哲学"章节呈现：

| # | 模式名称 | 源码体现 | 设计哲学 |
|---|---------|---------|---------|
| 1 | **幂等 Reconcile** | VCluster 安装、组件部署、应用 Provision | 任何操作可安全重试 |
| 2 | **Condition 状态机** | Cluster 6 种 Condition、AppVersion ReviewPhase | 可观测的生命周期 |
| 3 | **插件注册表** | ComponentInstaller、ProvisionerPlugin | 新功能无需改核心 |
| 4 | **Finalizer 保护** | Cluster/Workspace/NodeGroup/ApplicationVersion | 删除前确保资源清理 |
| 5 | **Annotation 统计** | member-count、node-count、ready-node-count | 避免 CRD Status 膨胀 |
| 6 | **Label 路由** | provisioner type、workspace、cluster、nodegroup | 声明式资源关联 |
| 7 | **缓存 + 失效** | 授权缓存 TTL 300s、ClusterClient sync.Map | 性能与一致性平衡 |
| 8 | **升级感知代理** | UpgradeAwareHandler 支持 WebSocket | exec/logs/port-forward 透传 |

---

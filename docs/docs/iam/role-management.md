# 角色管理详细指南

## 概述

角���管理是IAM模块的核心功能之一，提供了完整的角色生命周期管理能力。通过角色管理，管理员可以创建、查看、编辑、删除角色，配置角色权限，实现基于角色的访问控制（RBAC）。

## 角色管理界面

### 访问角色管理
1. 进入"控制台" → "访问控制" → "角色管理"
2. 系统显示角色列表界面

### 界面功能
角色管理界面提供了强大的角色筛选和搜索功能：

1. **范围筛选**
   - **全部范围**：显示所有层级的角色
   - **platform**：平台级角色，适用于整个平台
   - **cluster**：集群级角色，适用于特定集群
   - **workspace**：工作空间级角色，适用于特定工作空间
   - **namespace**：项目级角色，适用于特定项目
   - **nodegroup**：节点组级角色，适用于特定节点组

2. **具体资源选择**
   - 对于需要特定上下文的范围（如workspace、nodegroup、namespace）
   - 可以选择具体的集群、工作空间、项目等
   - 筛选结果会根据选择的资源动态更新

3. **搜索功能**
   - 支持按角色名称搜索
   - 实时过滤匹配结果
   - 支持模糊搜索

### 角色信息显示
角色列表以表格形式展示，包含以下信息：
- **角色名称**：角色的显示名称和系统名称
- **描述**：角色的功能说明
- **作用范围**：角色Type和ScopeValue
- **创建时间**：角色的创建时间
- **角色标识**：系统内置角色显示"模板"标识

## 角色层级体系

### 分层权限模型

```
平台级（Platform）
├── platform-admin：平台管理员
├── platform-regular：平台普通用户
└── platform-self-provision：自助服务用户

集群级（Cluster）
├── cluster-admin：集群管理员
├── cluster-regular：集群普通用户
└── cluster-view：集群查看者

工作空间级（Workspace）
├── workspace-admin：工作空间管理员
├── workspace-regular：工作空间普通用户
└── workspace-view：工作空间查看者

项目级（Namespace）
├── namespace-admin：项目管理员
├── namespace-regular：项目普通用户
└── namespace-view：项目查看者

节点组级（NodeGroup）
├── nodegroup-admin：节点组管理员
├── nodegroup-regular：节点组普通用户
└── nodegroup-view：节点组查看者
```

### 权限继承关系
- 上层权限自动包含下层权限
- 同层权限相互独立，不相互影响
- 用户可以拥有多个层级的角色

## 创建自定义角色

### 创建步骤

1. **点击"创建角色"按钮**
   - 位于角色列表页面右上角
   - 系统弹出创建角色对话框

2. **填写角色基本信息**
   ```
   必填信息：
   - 角色名称：唯一标识符，只能包含小写字母、数字、连字符
   - 显示名称：角色的友好名称
   - 角色类型：选择角色作用范围（platform/cluster/workspace/namespace/nodegroup）
   - 作用范围：选择具体的资源实例

   可选信息：
   - 描述：角色的功能说明和用途
   ```

3. **配置角色权限**
   - 从角色模板列表中选择权限模板
   - 可以选择多个模板组合权限
   - 系统显示每个模板包含的权限详情

4. **确认创建**
   - 点击"确定"按钮完成角色创建
   - 系统自动刷新角色列表
   - 新创建的角色出现在列表中

### 创建注意事项
- 角色名称必须全局唯一
- 角色类型和作用范围必须匹配
- 建议基于角色模板创建，避免从零开始配置权限
- 创建后需要为角色分配权限才能正常使用

## 编辑角色信息

### 编辑操作

1. **打开编辑对话框**
   - 在角色列表中找到目标角色
   - 点击操作菜单中的"编辑信息"
   - 系统弹出编辑角色信息对话框

2. **修改角色信息**
   ```
   可修改信息：
   - 显示名称：角色友好名称
   - 描述：角色功能说明
   - 权限模板：添加或移除权限模板

   不可修改信息：
   - 角色名称：创建后不能修改
   - 角色类型：创建后不能修改
   - 作用范围：创建后不能修改
   ```

3. **保存修改**
   - 点击"确定"按钮保存修改
   - 系统自动更新角色信息
   - 修改立即影响拥有该角色的用户

### 编辑注意事项
- 系统内置角色不能修改基本信息
- 修改角色权限会影响所有拥有该角色的用户
- 建议在非业务高峰期进行权限修改
- 权限变更会被记录在审计日志中

## 编辑角色权限

### 权限配置界面

1. **打开权限编辑对话框**
   - 在角色列表中找到目标角色
   - 点击操作菜单中的"编辑权限"
   - 系统弹出权限编辑对话框

2. **权限模板选择**
   ```
   权限模板分类：
   - 用户管理：用户CRUD操作权限
   - 角色管理：角色CRUD操作权限
   - 集群管理：集群资源操作权限
   - 工作空间管理：工作空间操作权限
   - 应用管理：应用部署和管理权限
   - 监控管理：监控和告警权限
   - 系统设置：系统配置权限
   ```

3. **权限组合配置**
   - 勾选需要的权限模板
   - 可以组合多个模板实现复杂权限
   - 系统显示已选择的权限列表

4. **保存权限配置**
   - 点击"确定"按钮保存权限配置
   - 系统更新角色权限
   - 权限变更立即生效

### 权限配置注意事项
- 权限采用最小权限原则，避免过度授权
- 权限模板可以组合使用，实现灵活的权限控制
- 修改权限会影响所有拥有该角色的用户
- 建议定期审查角色权限配置

## 删除角色

### 删除角色流程

1. **启动删除流程**
   - 在角色列表中找到目标角色
   - 点击操作菜单中的"删除角色"
   - 系统弹出删除确认对话框

2. **删除前置检查**
   ```
   系统自动检查：
   - 是否有用户绑定该角色
   - 是否为系统内置角色
   - 是否有依赖该角色的其他配置
   ```

3. **确认删除**
   - 如果检查通过，显示删除确认对话框
   - 确认要删除的角色名称
   - 点击"确定"按钮执行删除

4. **删除结果**
   - 删除成功后显示确认信息
   - 角色从角色列表中移除
   - 相关的用户角色绑定被清除

### 删除注意事项
- ⚠️ **系统内置角色无法删除**：platform-admin等内置角色受保护
- ⚠️ **有用户绑定的角色无法删除**：需要先解除所有用户绑定
- 删除角色会同时移除所有相关的角色绑定
- 删除操作无法撤销，请谨慎操作
- 建议删除前先确认角色不再使用

## 角色详情查看

### 角色详情页面

1. **进入角色详情**
   - 在角色列表中点击角色名称
   - 系统跳转到角色详情页面

2. **角色基本信息**
   ```
   基本信息区域：
   - 角色名称：系统名称
   - 显示名称：友好名称
   - 角色类型：platform/cluster/workspace等
   - 作用范围：具体的资源实例
   - 描述：角色功能说明
   - 创建时间：角色创建时间
   ```

3. **角色权限信息**
   ```
   权限信息区域：
   - 权限模板：角色使用的权限模板
   - 详细权限：具体的操作权限列表
   - 权限说明：每个权限的功能描述
   ```

4. **用户绑定信息**
   ```
   用户绑定区域：
   - 绑定用户列表：拥有该角色的用户
   - 绑定时间：用户获得角色的时间
   - 绑定方式：手动分配或自动继承
   ```

## 系统内置角色

### 平台级内置角色

**platform-admin（平台管理员）**
- 权限：平台的最高管理权限
- 范围：整个平台
- 能力：管理所有资源、用户、角色、集群等

**platform-regular（平台普通用户）**
- 权限：平台的基本使用权限
- 范围：整个平台
- 能力：查看平台信息、访问授权的资源

**platform-self-provision（自助服务用户）**
- 权限：自助创建工作空间的权限
- 范围：整个平台
- 能力：创建和管理自己的工作空间

### 集群级内置角色

**cluster-admin（集群管理员）**
- 权限：集群的完全管理权限
- 范围：特定集群
- 能力：管理集群内所有资源

**cluster-regular（集群普通用户）**
- 权限：集群的基本操作权限
- 范围：特定集群
- 能力：查看集群信息、操作授权的资源

### 工作空间级内置角色

**workspace-admin（工作空间管理员）**
- 权限：工作空间的完全管理权限
- 范围：特定工作空间
- 能力：管理工作空间内所有资源和用户

**workspace-regular（工作空间普通用户）**
- 权限：工作空间的基本操作权限
- 范围：特定工作空间
- 能力：查看工作空间信息、操作授权的项目

### 项目级内置角色

**namespace-admin（项目管理员）**
- 权限：项目的完全管理权限
- 范围：特定项目
- 能力：管理项目内所有资源

**namespace-regular（项目普通用户）**
- 权限：项目的基本操作权限
- 范围：特定项目
- 能力：查看项目信息、操作授权的应用

## 角色管理最佳实践

### 角色设计原则

1. **基于职能设计**
   - 按照工作职能划分角色，而不是按照人员
   - 例如：开发人员角色、运维人员角色、审计人员角色

2. **最小权限原则**
   - 角色只包含完成工作所需的最小权限
   - 避免过度授权造成安全风险

3. **职责分离**
   - 将敏感操作分配到不同的角色
   - 例如：创建角色和分配角色分离

4. **可继承性设计**
   - 设计角色层级关系，支持权限继承
   - 减少重复配置，提高管理效率

### 角色生命周期管理

1. **创建阶段**
   - 明确角色的用途和目标用户
   - 基于标准权限模板创建角色
   - 测试角色权限是否满足需求

2. **使用阶段**
   - 定期审查角色分配情况
   - 监控角色使用频率和效果
   - 收集用户反馈，优化角色配置

3. **维护阶段**
   - 定期更新角色权限，适应业务变化
   - 清理不再使用的角色
   - 审查角色权限配置，确保安全合规

### 权限配置建议

1. **使用权限模板**
   - 优先使用系统提供的权限模板
   - 通过组合模板实现复杂权限需求
   - 避免手动配置细粒度权限

2. **权限审查**
   - 定期审查角色权限配置
   - 移除不需要的权限
   - 确保权限配置符合安全策略

3. **权限测试**
   - 角色创建后进行权限测试
   - 验证权限是否按预期工作
   - 测试权限边界和限制条件

## 故障排查

### 常见问题

**问题1：无法创建角色**
- 检查角色名称是否已存在
- 确认角色类型和作用范围是否匹配
- 验证是否有足够的权限创建角色

**问题2：角色权限不生效**
- 确认用户是否重新登录
- 检查角色权限是否正确配置
- 验证角色作用范围是否正确

**问题3：无法删除角色**
- 检查是否有用户绑定该角色
- 确认是否为系统内置角色
- 查看系统错误日志

**问题4：权限配置错误**
- 使用权限测试工具验证权限
- 检查权限模板是否正确选择
- 确认权限组合是否合理

## 相关文档
- [IAM概述](./iam-overview.md)
- [用户管理指南](./user-management.md)
- [权限管理指南](./permission-management.md)
- [访问控制最佳实践](./access-control-best-practices.md)
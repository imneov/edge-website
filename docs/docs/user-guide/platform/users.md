---
sidebar_position: 1
title: 用户管理
---

# 用户管理

用户管理是边缘平台的核心功能之一，允许管理员创建、管理和维护平台用户账号。

## 📋 概述

### 用户类型

边缘平台支持以下用户类型：

| 类型 | 说明 | 用途 |
|------|------|------|
| **平台管理员** | 拥有平台最高权限 | 管理整个平台，包括用户、集群、工作空间等 |
| **集群管理员** | 管理特定集群 | 管理指定集群的资源和配置 |
| **工作空间管理员** | 管理工作空间 | 管理工作空间及其资源 |
| **普通用户** | 基础使用权限 | 访问被授权的资源 |

### 用户状态

| 状态 | 图标 | 说明 |
|------|------|------|
| **激活** | 🟢 | 用户可以正常登录和使用 |
| **禁用** | 🔴 | 用户被临时禁用，无法登录 |
| **锁定** | 🔒 | 由于安全原因被锁定（如多次登录失败）|
| **待激活** | 🟡 | 新创建用户，等待首次登录激活 |

## 👥 查看用户列表

### 访问用户管理页面

1. 登录边缘平台 Console
2. 点击左侧菜单"平台管理" > "访问控制" > "用户管理"

### 用户列表视图

用户列表显示以下信息：

```
┌──────────────────────────────────────────────────────────────────┐
│ 用户名     │ 显示名称 │ 邮箱               │ 角色    │ 状态 │ 操作   │
├──────────────────────────────────────────────────────────────────┤
│ admin     │ 管理员   │ admin@example.com │ 平台管理 │ 激活 │ [...]│
│ user1     │ 张三     │ user1@example.com │ 开发者  │ 激活 │ [...]│
│ user2     │ 李四     │ user2@example.com │ 观察者  │ 禁用 │ [...]│
└──────────────────────────────────────────────────────────────────┘
```

### 搜索和筛选

**按用户名搜索**：

- 在搜索框输入用户名或显示名称
- 支持模糊匹配

**按状态筛选**：

- 全部
- 仅激活
- 仅禁用
- 仅锁定

**按角色筛选**：

- 平台管理员
- 集群管理员
- 工作空间管理员
- 普通用户

## ➕ 创建用户

### 步骤 1: 打开创建对话框

1. 在用户管理页面，点击右上角"创建用户"按钮
2. 在弹出的对话框中填写用户信息

### 步骤 2: 填写基本信息

| 字段 | 必填 | 说明 | 示例 |
|------|------|------|------|
| **用户名*** | ✅ | 用户唯一标识，不可修改 | `zhangsan` |
| **显示名称** | ❌ | 在 UI 中显示的名称 | `张三` |
| **邮箱*** | ✅ | 用户邮箱地址 | `zhangsan@example.com` |
| **密码*** | ✅ | 初始密码 | - |
| **确认密码*** | ✅ | 再次输入密码 | - |
| **手机号** | ❌ | 联系电话 | `13800138000` |

:::tip 用户名规范
- 只能包含小写字母、数字、连字符（-）和下划线（_）
- 长度 3-32 个字符
- 必须以字母开头
:::

### 步骤 3: 设置密码策略

**密码要求**：

- ✅ 长度 ≥ 8 个字符
- ✅ 包含大写字母
- ✅ 包含小写字母
- ✅ 包含数字
- ✅ 包含特殊字符

**密码策略选项**：

| 选项 | 说明 | 默认值 |
|------|------|--------|
| **首次登录强制修改** | 用户首次登录时必须修改密码 | 开启 |
| **密码有效期** | 密码过期时间（天） | 90 |
| **密码历史** | 不能使用最近 N 次密码 | 3 |

### 步骤 4: 分配角色

选择用户的平台级角色：

**预定义角色**：

| 角色 | 权限范围 | 适用场景 |
|------|----------|----------|
| **platform-admin** | 平台完全控制权限 | 平台管理员 |
| **platform-regular** | 基础使用权限 | 普通用户 |
| **platform-viewer** | 只读权限 | 审计和监控人员 |

**自定义角色**：

- 可以选择自定义创建的平台角色
- 组合多个角色实现精细权限控制

### 步骤 5: 配置高级选项

展开"高级设置"：

| 选项 | 说明 | 默认值 |
|------|------|--------|
| **账号有效期** | 账号过期时间 | 无限期 |
| **允许多设备登录** | 是否允许同时多设备登录 | 允许 |
| **双因素认证** | 是否强制启用 2FA | 关闭 |
| **标签** | 自定义用户标签 | - |
| **描述** | 用户描述信息 | - |

### 步骤 6: 完成创建

1. 检查所有信息无误
2. 点击"确定"按钮
3. 系统创建用户并发送通知邮件（如果配置了邮件服务）

## ✏️ 编辑用户

### 修改基本信息

1. 在用户列表中点击用户名
2. 进入用户详情页
3. 点击"编辑"按钮
4. 修改以下信息：
   - 显示名称
   - 邮箱
   - 手机号
   - 描述

:::info 不可修改项
用户名创建后不可修改。如需更改，请创建新用户并迁移权限。
:::

### 重置密码

**管理员重置密码**：

1. 进入用户详情页
2. 点击"重置密码"按钮
3. 输入新密码
4. 选择是否强制用户下次登录修改
5. 点击"确认"

**通知用户**：

- ✅ 发送密码重置邮件
- ✅ 发送站内消息
- ✅ 短信通知（如果配置）

### 修改角色

1. 进入用户详情页
2. 点击"角色"标签
3. 可以：
   - ➕ 添加新角色
   - ➖ 移除现有角色
   - 📝 修改角色范围

## 🔐 用户权限管理

### 查看用户权限

在用户详情页的"权限"标签，可以看到：

**平台级权限**：

```yaml
平台管理:
  - 用户管理
  - 角色管理
  - 集群管理
```

**集群级权限**：

```yaml
prod-cluster:
  - 查看集群信息
  - 管理工作负载
  - 配置网络策略

test-cluster:
  - 查看集群信息
```

**工作空间级权限**：

```yaml
dev-workspace:
  角色: workspace-admin
  权限:
    - 管理工作空间
    - 管理项目
    - 邀请成员

qa-workspace:
  角色: workspace-viewer
  权限:
    - 查看工作空间信息
    - 查看项目
```

### 授予集群权限

1. 进入用户详情页
2. 点击"集群权限"标签
3. 点击"添加集群权限"
4. 选择集群和角色：
   - 集群: `prod-cluster`
   - 角色: `cluster-admin` 或 `cluster-viewer`
5. 点击"确认"

### 授予工作空间权限

1. 进入用户详情页
2. 点击"工作空间权限"标签
3. 点击"添加工作空间权限"
4. 选择工作空间和角色：
   - 工作空间: `dev-workspace`
   - 角色: `workspace-admin` 或 `workspace-member`
5. 点击"确认"

## 🚫 禁用和删除用户

### 禁用用户

**临时禁用用户访问**：

1. 在用户列表或详情页
2. 点击操作菜单 > "禁用"
3. 确认操作

**禁用效果**：

- ❌ 用户无法登录
- ❌ 现有会话会被终止
- ✅ 用户数据保留
- ✅ 权限配置保留

**重新启用**：

1. 找到禁用的用户
2. 点击操作菜单 > "启用"

### 删除用户

:::danger 危险操作
删除用户是**不可逆操作**，请谨慎操作！
:::

**删除步骤**：

1. 在用户操作菜单中选择"删除"
2. 系统会提示确认：
   ```
   确认删除用户 "zhangsan" 吗？

   此操作将：
   ✅ 删除用户账号
   ✅ 撤销所有权限
   ✅ 删除用户创建的资源（可选）

   此操作不可恢复！
   ```
3. 输入用户名确认
4. 点击"确认删除"

**删除选项**：

| 选项 | 说明 | 建议 |
|------|------|------|
| **保留资源** | 保留用户创建的资源 | ✅ 推荐 |
| **转移资源** | 将资源转移给其他用户 | ✅ 推荐 |
| **删除资源** | 同时删除用户创建的资源 | ⚠️ 谨慎使用 |

## 🔍 用户详情

### 基本信息

```yaml
用户名: zhangsan
显示名称: 张三
邮箱: zhangsan@example.com
手机号: 13800138000
状态: 激活
创建时间: 2024-01-15 10:30:00
最后登录: 2024-10-17 14:25:30
```

### 登录历史

查看用户最近的登录记录：

| 时间 | IP 地址 | 位置 | 设备 | 状态 |
|------|---------|------|------|------|
| 2024-10-17 14:25 | 192.168.1.100 | 北京 | Chrome/Mac | ✅ 成功 |
| 2024-10-17 09:10 | 192.168.1.100 | 北京 | Chrome/Mac | ✅ 成功 |
| 2024-10-16 18:30 | 10.0.0.50 | 上海 | Safari/iOS | ✅ 成功 |

### 活动日志

查看用户的操作记录：

| 时间 | 操作 | 资源 | 结果 |
|------|------|------|------|
| 2024-10-17 14:30 | 创建 | Deployment/nginx | ✅ 成功 |
| 2024-10-17 14:25 | 登录 | - | ✅ 成功 |
| 2024-10-17 10:15 | 更新 | ConfigMap/app-config | ✅ 成功 |

### 资源统计

查看用户拥有或创建的资源：

```yaml
集群: 3
工作空间: 5
项目: 12
应用: 28
```

## 🔒 安全设置

### 账号锁定

**自动锁定条件**：

- 连续 5 次登录失败
- 密码过期未更新
- 管理员手动锁定

**解锁方法**：

1. 自动解锁（30 分钟后）
2. 管理员手动解锁：
   - 进入用户详情页
   - 点击"解锁账号"按钮

### 双因素认证 (2FA)

**为用户启用 2FA**：

1. 进入用户详情页 > "安全设置"
2. 开启"强制双因素认证"
3. 用户下次登录时需要设置 2FA

**支持的 2FA 方式**：

- 📱 TOTP 应用（Google Authenticator, Microsoft Authenticator）
- 📧 邮件验证码
- 📱 短信验证码

### 会话管理

**查看活动会话**：

1. 进入用户详情页 > "会话管理"
2. 查看所有活动会话
3. 可以终止特定会话

**强制登出**：

1. 选择要终止的会话
2. 点击"终止会话"
3. 用户需要重新登录

## 📊 用户统计

### 用户概览

在用户管理页面顶部显示：

```
总用户数: 156
激活用户: 142
禁用用户: 12
锁定用户: 2
```

### 活跃度统计

```
今日登录: 45
本周登录: 98
本月登录: 142
```

### 角色分布

```yaml
平台管理员: 5
集群管理员: 12
工作空间管理员: 28
普通用户: 111
```

## 🔄 批量操作

### 批量导入用户

**使用 CSV 文件导入**：

1. 下载 CSV 模板
2. 填写用户信息：

```csv
username,display_name,email,role
user001,用户001,user001@example.com,platform-regular
user002,用户002,user002@example.com,platform-regular
user003,用户003,user003@example.com,platform-viewer
```

3. 上传 CSV 文件
4. 预览导入结果
5. 确认导入

### 批量禁用/启用

1. 在用户列表中选择多个用户（勾选复选框）
2. 点击顶部"批量操作"按钮
3. 选择"禁用"或"启用"
4. 确认操作

### 批量分配角色

1. 选择多个用户
2. 点击"批量操作" > "分配角色"
3. 选择要分配的角色
4. 选择添加或替换模式
5. 确认操作

## 🆘 常见问题

### Q: 如何重置管理员密码？

**方式 1: 通过其他管理员**

如果有其他管理员账号，可以通过 Console 重置。

**方式 2: 通过 kubectl**

```bash
# 创建临时管理员用户
kubectl create user temp-admin --role=platform-admin

# 使用临时账号登录并重置密码
```

### Q: 用户删除后可以恢复吗？

**答**: 不可以。用户删除是不可逆操作。建议：
- 先禁用用户而不是删除
- 定期备份用户数据

### Q: 如何限制用户只能在特定IP登录？

**答**: 在用户高级设置中配置 IP 白名单：

1. 进入用户详情 > "安全设置"
2. 开启"IP 白名单"
3. 添加允许的 IP 地址或 CIDR
4. 保存配置

### Q: 如何批量修改用户密码策略？

**答**: 密码策略是全局配置，在"平台设置" > "安全策略"中修改。

## 📖 下一步

完成用户管理后，您可以：

- [配置角色](./roles.md) - 创建和管理自定义角色
- [平台设置](./settings.md) - 配置全局策略
- [创建工作空间](../workspaces/create.md) - 为用户分配工作空间

---

**需要帮助？** 请查看 [访问控制详细文档](../platform/access-control.md) 或 [安全最佳实践](../../developer/best-practices/security.md)。

---
sidebar_position: 3
title: 平台设置
---

# 平台设置

平台设置允许管理员配置边缘平台的全局策略、安全选项和系统参数。

## 📋 访问平台设置

### 权限要求

- **必需权限**: `platform-admin` 角色
- **页面路径**: 平台管理 > 平台设置

### 设置分类

平台设置分为以下几个主要类别：

```
平台设置
├── 基本设置        # 平台基本信息和配置
├── 安全策略        # 密码策略、会话管理、访问控制
├── OAuth 配置      # OAuth 认证服务器配置
├── 通知设置        # 邮件、Webhook、站内消息
├── 监控集成        # Prometheus、Grafana 集成
├── 存储配置        # 镜像仓库、对象存储
└── 系统维护        # 备份、日志、升级
```

## 🏢 基本设置

### 平台信息

配置平台的基本信息：

| 字段 | 说明 | 示例 |
|------|------|------|
| **平台名称** | 在 Console 中显示的平台名称 | `边缘计算平台` |
| **平台标识** | 平台的唯一标识符 | `edge-platform` |
| **平台 Logo** | 上传平台 Logo 图片 | - |
| **联系邮箱** | 平台管理员联系邮箱 | `admin@example.com` |
| **技术支持** | 技术支持链接或文档 | `https://docs.example.com` |

### 控制台配置

配置 Console 的行为：

```yaml
会话超时: 2小时
最大并发会话: 5
默认语言: 简体中文
默认主题: 亮色
时区: Asia/Shanghai
日期格式: YYYY-MM-DD HH:mm:ss
```

### 资源配额

配置平台级别的默认资源配额：

| 资源类型 | 默认配额 | 说明 |
|---------|---------|------|
| **工作空间数量** | 无限制 | 每个用户可创建的工作空间数 |
| **集群数量** | 无限制 | 平台可管理的集群总数 |
| **项目数量** | 100 | 每个工作空间的项目数限制 |

## 🔐 安全策略

### 密码策略

配置全局密码安全要求：

**基础策略**：

```yaml
密码最小长度: 8
密码最大长度: 32
必须包含大写字母: 是
必须包含小写字母: 是
必须包含数字: 是
必须包含特殊字符: 是
允许的特殊字符: !@#$%^&*()_+-=[]{}|;:,.<>?
```

**高级策略**：

```yaml
密码历史记录: 3    # 不能使用最近 3 次密码
密码有效期: 90天
密码过期前提醒: 7天
首次登录强制修改: 是
禁止包含用户名: 是
禁止常见弱密码: 是
```

**密码强度检查**：

```yaml
弱密码拒绝: 是
中等强度要求: 至少 10 个字符，包含 3 种字符类型
强密码要求: 至少 12 个字符，包含 4 种字符类型
```

### 账号锁定策略

配置账号锁定保护机制：

```yaml
启用账号锁定: 是
失败登录次数阈值: 5
锁定时长: 30分钟
锁定后通知管理员: 是
管理员锁定白名单: admin
```

### 会话管理

配置用户会话策略：

```yaml
会话超时时间: 2小时
空闲超时时间: 30分钟
强制单一会话: 否
允许多设备登录: 是
最大并发会话数: 5
会话过期前提醒: 5分钟
```

### 访问控制

配置全局访问控制策略：

**IP 白名单**：

```yaml
启用 IP 白名单: 否
允许的 IP 范围:
  - 192.168.0.0/16
  - 10.0.0.0/8
```

**API 访问限制**：

```yaml
API 速率限制: 1000 请求/分钟
单用户速率限制: 100 请求/分钟
黑名单 IP:
  - 1.2.3.4
  - 5.6.7.8
```

### 双因素认证 (2FA)

配置 2FA 策略：

```yaml
启用 2FA: 是
强制启用 2FA: 否    # 管理员可强制特定角色启用
管理员强制 2FA: 是
2FA 方式:
  - TOTP (Google Authenticator)
  - 邮件验证码
  - 短信验证码 (需配置短信服务)
```

## 🔑 OAuth 配置

### OAuth 服务器配置

边缘平台内置 OAuth 认证服务器，需要配置以下参数：

**基本配置**：

```yaml
启用 OAuth 服务器: 是
Issuer URL: https://edge-platform.example.com
授权端点: /oauth/authorize
令牌端点: /oauth/token
用户信息端点: /oauth/userinfo
JWKS 端点: /oauth/jwks
```

**令牌配置**：

```yaml
访问令牌有效期: 1小时
刷新令牌有效期: 30天
ID 令牌有效期: 1小时
令牌签名算法: RS256
```

### OAuth 客户端管理

配置允许访问的 OAuth 客户端：

**添加客户端**：

1. 点击"OAuth 配置" > "客户端管理"
2. 点击"添加客户端"
3. 填写客户端信息：

```yaml
客户端 ID: edge-console
客户端密钥: <auto-generated>
客户端名称: Edge Platform Console
重定向 URI:
  - https://console.example.com/oauth/callback
授权类型:
  - authorization_code
  - refresh_token
  - password
允许的 Scope:
  - openid
  - profile
  - email
  - offline_access
```

**内置客户端**：

| 客户端 ID | 说明 | 授权类型 |
|----------|------|----------|
| `edge-console` | 官方 Console | authorization_code |
| `edge-cli` | 命令行工具 | password |
| `edge-api` | API 访问 | client_credentials |

### OIDC 配置

配置 OpenID Connect 参数：

```yaml
启用 OIDC: 是
支持的响应类型:
  - code
  - id_token
  - token id_token
支持的 Scope:
  - openid
  - profile
  - email
  - groups
  - offline_access
ID Token 包含字段:
  - sub (用户 ID)
  - name (显示名称)
  - email (邮箱)
  - groups (用户组)
```

## 📧 通知设置

### 邮件配置

配置 SMTP 服务器用于发送邮件通知：

**SMTP 设置**：

```yaml
SMTP 服务器: smtp.example.com
SMTP 端口: 587
启用 TLS: 是
发件人地址: noreply@example.com
发件人名称: 边缘计算平台
认证用户名: smtp-user@example.com
认证密码: ********
```

**测试邮件**：

1. 点击"发送测试邮件"
2. 输入测试邮箱地址
3. 检查邮件接收情况

**邮件模板**：

配置不同场景的邮件模板：

| 模板类型 | 说明 | 可定制 |
|---------|------|--------|
| **用户邀请** | 邀请用户加入平台 | ✅ |
| **密码重置** | 密码重置链接 | ✅ |
| **账号激活** | 新用户激活邮件 | ✅ |
| **系统通知** | 系统维护通知 | ✅ |
| **告警通知** | 告警事件通知 | ✅ |

### Webhook 配置

配置 Webhook 用于集成外部系统：

**添加 Webhook**：

```yaml
名称: 钉钉通知
URL: https://oapi.dingtalk.com/robot/send?access_token=xxx
事件类型:
  - 用户创建
  - 集群添加
  - 告警触发
  - 系统错误
请求方法: POST
内容类型: application/json
自定义头部:
  Content-Type: application/json
签名密钥: ********
```

**支持的事件**：

| 事件类别 | 事件 |
|---------|------|
| **用户事件** | 用户创建、删除、禁用、解锁 |
| **集群事件** | 集群添加、删除、离线、恢复 |
| **告警事件** | 告警触发、告警恢复 |
| **审计事件** | 敏感操作审计 |

### 站内消息

配置站内消息通知：

```yaml
启用站内消息: 是
消息保留时间: 30天
未读消息提醒: 是
桌面通知: 是 (需要浏览器授权)
```

## 📊 监控集成

### Prometheus 配置

配置 Prometheus 监控系统集成：

```yaml
Prometheus URL: http://prometheus.edge-system:9090
查询超时: 30秒
并发查询数: 5
启用认证: 否
```

**配置指标采集**：

```yaml
采集间隔: 30秒
采集超时: 10秒
保留时间: 15天
```

### Grafana 配置

配置 Grafana 可视化集成：

```yaml
Grafana URL: http://grafana.edge-system:3000
管理员用户: admin
管理员密码: ********
组织 ID: 1
```

**自动创建仪表板**：

```yaml
启用自动创建: 是
默认仪表板:
  - 集群概览
  - 节点监控
  - 工作负载监控
  - 应用监控
```

### 日志配置

配置日志系统集成（Loki）：

```yaml
Loki URL: http://loki.edge-system:3100
查询超时: 60秒
日志保留时间: 7天
最大查询范围: 24小时
```

## 💾 存储配置

### 镜像仓库

配置容器镜像仓库：

**添加镜像仓库**：

```yaml
名称: Harbor
地址: https://harbor.example.com
类型: Harbor
认证方式: 用户名密码
用户名: admin
密码: ********
默认项目: library
是否默认: 是
```

**支持的仓库类型**：

- Docker Hub
- Harbor
- Nexus
- 阿里云 ACR
- 腾讯云 TCR
- 自定义镜像仓库

### 对象存储

配置对象存储用于备份和文件存储：

**S3 兼容存储**：

```yaml
存储类型: S3
Endpoint: https://s3.example.com
Bucket: edge-platform-backup
Region: us-east-1
Access Key: ********
Secret Key: ********
```

**支持的存储类型**：

- AWS S3
- MinIO
- 阿里云 OSS
- 腾讯云 COS
- 其他 S3 兼容存储

## 🔧 系统维护

### 备份配置

配置自动备份策略：

```yaml
启用自动备份: 是
备份频率: 每天
备份时间: 02:00
备份保留天数: 30
备份存储: S3 (已配置)
备份范围:
  - 用户数据
  - 角色和权限
  - 集群配置
  - 工作空间配置
  - 平台设置
```

**手动备份**：

1. 点击"系统维护" > "备份管理"
2. 点击"立即备份"
3. 选择备份范围
4. 等待备份完成

**恢复备份**：

1. 在备份列表中选择要恢复的备份
2. 点击"恢复"
3. 确认恢复操作
4. 等待恢复完成

### 日志管理

配置平台日志：

```yaml
日志级别: INFO
日志输出:
  - 控制台
  - 文件 (/var/log/edge-platform/)
日志轮转: 每天
日志保留: 7天
审计日志: 永久保留
```

**日志级别说明**：

| 级别 | 说明 | 适用场景 |
|------|------|----------|
| **DEBUG** | 调试信息 | 开发环境 |
| **INFO** | 一般信息 | 生产环境（推荐）|
| **WARN** | 警告信息 | - |
| **ERROR** | 错误信息 | - |

### 系统升级

配置系统升级策略：

```yaml
检查更新: 自动
更新通知: 是
允许自动升级: 否
升级窗口: 周日 02:00-06:00
```

**手动升级**：

1. 点击"检查更新"
2. 查看新版本详情和变更日志
3. 点击"下载更新"
4. 安排升级时间
5. 执行升级

## 📈 使用统计

### 平台统计

查看平台使用情况：

```yaml
用户总数: 156
活跃用户: 142
集群数量: 8
工作空间数量: 45
项目数量: 128
应用数量: 356
```

### 资源使用

查看资源使用统计：

```yaml
CPU 使用率: 45%
内存使用率: 62%
存储使用率: 38%
网络带宽: 125 Mbps
```

## 🛡️ 审计日志

### 查看审计日志

访问审计日志：

1. 点击"平台设置" > "审计日志"
2. 查看所有敏感操作记录

**审计日志内容**：

| 字段 | 说明 |
|------|------|
| **时间** | 操作时间 |
| **用户** | 操作用户 |
| **操作** | 操作类型 |
| **资源** | 操作的资源 |
| **结果** | 成功/失败 |
| **IP 地址** | 来源 IP |
| **详情** | 操作详细信息 |

### 审计事件类型

记录的审计事件：

```yaml
用户管理:
  - 创建用户
  - 删除用户
  - 修改密码
  - 重置密码
  - 锁定/解锁账号

权限管理:
  - 创建角色
  - 删除角色
  - 修改角色
  - 角色绑定

集群管理:
  - 添加集群
  - 删除集群
  - 修改集群配置

系统设置:
  - 修改安全策略
  - 修改OAuth配置
  - 系统升级
```

## 🆘 常见问题

### Q: 如何重置平台设置为默认值？

**答**:

1. 进入对应的设置页面
2. 点击"重置为默认值"按钮
3. 确认操作

:::warning 谨慎操作
重置设置会立即生效，可能影响平台运行。
:::

### Q: 修改密码策略后，现有用户需要重新设置密码吗？

**答**: 不需要。新策略仅对以下情况生效：
- 用户修改密码时
- 管理员重置密码时
- 新用户创建时

### Q: 如何备份平台配置？

**答**:

```bash
# 使用 kubectl 导出配置
kubectl get configmap -n edge-system edge-platform-config -o yaml > config-backup.yaml

# 或使用平台自带的备份功能
点击"系统维护" > "备份管理" > "立即备份"
```

### Q: OAuth 配置修改后需要重启服务吗？

**答**: 不需要。大部分配置修改后会动态加载，无需重启。

## ✅ 配置检查清单

完成平台设置后，请确认：

- [ ] 已配置平台基本信息
- [ ] 已设置合理的密码策略
- [ ] 已配置 OAuth 认证
- [ ] 已配置邮件通知（如需）
- [ ] 已集成监控系统（Prometheus/Grafana）
- [ ] 已配置备份策略
- [ ] 已配置审计日志
- [ ] 已测试所有关键配置

## 📖 下一步

完成平台设置后，您可以：

- [创建用户](./users.md) - 添加平台用户
- [配置角色](./roles.md) - 创建自定义角色
- [添加集群](../../quick-start/first-cluster.md) - 开始管理集群

---

**需要帮助？** 请查看 [系统管理文档](../platform/overview.md) 或 [安全最佳实践](../../developer/best-practices/security.md)。

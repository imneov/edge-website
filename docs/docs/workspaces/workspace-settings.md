# 租户空间设置

## 概述

租户空间设置页面允许管理员配置租户空间的各种参数和策略，包括基本信息、资源配额、网络策略、访问控制等。通过合理配置这些设置，可以确保租户空间的安全性、性能和可用性。

## 访问设置页面

### 导航路径

1. 进入租户空间管理页面
2. 选择要配置的租户空间
3. 在租户空间详情页面中点击 **"租户空间设置"**
4. 或直接通过URL访问：`/boss/clusters/{cluster}/workspaces/{workspace}/settings`

## 设置页面结构

设置页面通常包含以下主要部分：

### 1. 基本信息设置

配置租户空间的基本属性：

#### 名称和描述
- **租户空间名称**：唯一标识符（创建后不可修改）
- **显示名称**：用户友好的名称
- **描述信息**：详细说明租户空间的用途

#### 管理员配置
- **主要管理员**：租户空间的主要负责人
- **备用管理员**：备用管理员列表
- **管理员权限**：配置管理员的权限范围

### 2. 资源配额设置

配置租户空间的资源限制：

#### CPU配额
- **预留CPU**：保证可用的CPU资源（核心数）
- **CPU上限**：最大可使用的CPU资源（核心数）
- **默认请求**：新项目的默认CPU请求值
- **默认限制**：新项目的默认CPU限制值

#### 内存配额
- **预留内存**：保证可用的内存资源（GiB）
- **内存上限**：最大可使用的内存资源（GiB）
- **默认请求**：新项目的默认内存请求值
- **默认限制**：新项目的默认内存限制值

#### 存储配额
- **存储空间**：最大可使用的存储空间（GB）
- **存储类**：默认的存储类类型
- **卷数量限制**：可创建的持久卷数量

#### GPU配额（如可用）
- **GPU类型**：可用的GPU型号
- **GPU数量**：可使用的GPU核心数
- **GPU分配策略**：GPU资源的分配方式

### 3. 网络策略设置

配置租户空间的网络访问控制：

#### 网络隔离
- **启用网络隔离**：是否启用项目间网络隔离
- **默认策略**：允许或拒绝所有网络流量
- **DNS策略**：DNS解析策略配置

#### 入站规则
- **允许的源地址**：允许访问的IP地址范围
- **允许的端口**：开放的端口范围
- **协议类型**：TCP、UDP等协议限制

#### 出站规则
- **允许的目标地址**：可访问的外部地址
- **允许的端口**：可访问的外部端口
- **协议限制**：出站流量协议限制

### 4. 访问控制设置

配置租户空间的访问权限：

#### 成员管理
- **成员邀请**：邀请新成员的权限设置
- **成员移除**：移除成员的权限设置
- **角色分配**：分配和管理角色的权限

#### 权限策略
- **默认角色**：新成员的默认角色
- **自定义角色**：创建和管理自定义角色
- **权限继承**：是否继承上级权限

#### 审计设置
- **启用审计日志**：是否记录操作日志
- **日志保留期**：审计日志的保留时间
- **敏感操作**：需要额外验证的操作

### 5. 安全策略设置

配置租户空间的安全策略：

#### 镜像安全
- **允许的镜像仓库**：允许拉取镜像的仓库列表
- **镜像扫描**：是否启用镜像安全扫描
- **签名验证**：是否验证镜像签名

#### Pod安全策略
- **运行用户**：Pod运行的用户ID
- **特权模式**：是否允许特权容器
- ** capabilities**：允许的Linux capabilities
- **文件系统**：根文件系统读写权限

#### 资源限制
- **进程数限制**：容器的最大进程数
- **文件句柄数**：打开文件的最大数量
- **线程数限制**：容器的最大线程数

### 6. 备份和恢复设置

配置数据备份策略：

#### 备份配置
- **启用自动备份**：是否启用自动备份
- **备份频率**：备份的时间间隔
- **保留策略**：备份文件的保留时间
- **备份位置**：备份存储的位置

#### 恢复配置
- **恢复点选择**：选择要恢复的备份点
- **恢复策略**：完全恢复或选择性恢复
- **恢复验证**：恢复后的验证流程

### 7. 监控和告警设置

配置监控和告警策略：

#### 监控配置
- **启用监控**：是否启用资源监控
- **监控粒度**：数据收集的时间间隔
- **监控指标**：要监控的指标列表

#### 告警配置
- **告警规则**：配置各种告警规则
- **通知渠道**：告警通知的方式（邮件、短信、webhook）
- **告警级别**：定义告警的严重程度
- **告警抑制**：配置告警抑制规则

### 8. 限额和限制设置

配置各种资源和操作的限额：

#### 资源限额
- **最大项目数**：可创建的项目总数
- **最大容器组数**：可创建的Pod总数
- **最大服务数**：可创建的服务总数
- **最大配置数量**：可创建的ConfigMap总数

#### 操作限额
- **API调用频率**：API调用的速率限制
- **并发操作数**：同时进行的操作数量
- **批量操作大小**：批量操作的最大数量

## 配置最佳实践

### 资源配额配置

1. **合理设置预留和上限**
   ```yaml
   # 推荐配置
   cpu:
     request: "总CPU的60%"    # 预留60%供重要项目使用
     limit: "总CPU的90%"      # 上限设为90%，保留10%给系统
   memory:
     request: "总内存的70%"   # 预留70%供重要项目使用
     limit: "总内存的85%"     # 上限设为85%，保留15%给系统
   ```

2. **根据项目类型设置不同的配额**
   - 开发环境：较低配额，满足基本需求
   - 测试环境：中等配额，模拟生产环境
   - 生产环境：高配额，保证性能和可用性

### 网络策略配置

1. **默认拒绝所有流量**
   ```yaml
   # 推荐的安全配置
   defaultPolicy: "deny"      # 默认拒绝所有网络流量
   enableIsolation: true      # 启用项目间网络隔离
   ```

2. **按需开放必要的端口**
   ```yaml
   ingressRules:
     - from: ["10.0.0.0/8"]   # 仅允许内网访问
       ports: [443, 8080]     # 仅开放必要的端口
       protocol: TCP
   ```

### 安全策略配置

1. **限制容器的特权**
   ```yaml
   securityPolicy:
     allowPrivileged: false        # 禁止特权容器
     allowRoot: false              # 禁止root用户运行
     readOnlyRootFilesystem: true  # 只读根文件系统
   ```

2. **限制资源使用**
   ```yaml
   resourceLimits:
     maxProcesses: 100         # 限制进程数
     maxFiles: 1024            # 限制文件句柄数
     maxThreads: 50            # 限制线程数
   ```

## 配置验证

### 配置检查

在应用配置之前，系统会进行以下检查：

1. **语法验证**：检查配置语法是否正确
2. **逻辑验证**：检查配置参数是否合理
3. **依赖验证**：检查依赖关系是否满足
4. **冲突验证**：检查是否存在配置冲突

### 配置测试

应用配置前可以进行测试：

1. **模拟应用**：在不影响实际环境的情况下应用配置
2. **影响评估**：评估配置变更的影响范围
3. **回滚准备**：准备回滚方案以防出现问题

## 配置变更流程

### 标准变更流程

1. **评估影响**
   - 分析配置变更的影响范围
   - 识别可能的风险点
   - 制定应对方案

2. **测试验证**
   - 在测试环境中验证配置
   - 确认配置行为符合预期
   - 检查是否有副作用

3. **应用配置**
   - 选择合适的时间窗口
   - 通知相关人员
   - 执行配置变更

4. **监控验证**
   - 监控系统运行状态
   - 验证配置是否生效
   - 确认没有异常情况

### 紧急变更流程

对于紧急配置变更：

1. **快速评估**：快速评估变更的必要性
2. **最小化变更**：只变更必要的配置项
3. **实时监控**：��切监控系统状态
4. **快速回滚**：如有问题立即回滚

## 配置备份和恢复

### 配置备份

定期备份租户空间配置：

1. **自动备份**：启用自动定时备份
2. **手动备份**：在重大变更前手动备份
3. **版本管理**：使用版本控制管理配置历史

### 配置恢复

从备份恢复配置：

1. **选择备份点**：选择合适的备份版本
2. **验证配置**：确认配置的正确性
3. **应用配置**：应用备份的配置
4. **验证效果**：确认配置恢复成功

## 故障排除

### 常见配置问题

**Q: 配置保存失败？**

A: 可能原因：
- 配置参数格式错误
- 资源配额超出限制
- 网络策略配置冲突
- 权限不足

解决方法：
- 检查配置参数格式
- 验证资源配额是否合理
- 检查网络策略是否有冲突
- 确认是否有配置权限

**Q: 配置应用后系统异常？**

A: 排查步骤：
- 检查配置是否正确应用
- 查看系统日志和错误信息
- 验证资源配置是否合理
- 如需要，回滚到之前配置

**Q: 资源配额不生效？**

A: 可能原因：
- 配置尚未应用
- 项目的资源请求超过配额
- 优先级设置不正确

解决方法：
- 等待配置生效或手动刷新
- 调整项目的资源配置
- 检查优先级设置

## 相关功能

设置页面与以下功能相关：

- **资源配额管理**：详细配置资源限制
- **网络策略**：配置网络访问控制
- **成员管理**：管理用户和权限
- **监控告警**：配置监控策略

## 下一步

- 学习如何[配置资源配额](./workspace-quotas.md)
- 了解如何[配置网络策略](./workspace-networking.md)
- 管理[租户空间成员](./workspace-members.md)
- 配置[监控和告警](./workspace-monitoring.md)